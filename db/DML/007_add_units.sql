CREATE OR REPLACE FUNCTION get_random_officer_mbn() RETURNS VARCHAR(255) AS
$$
DECLARE
    random_officer_mbn VARCHAR(255);
BEGIN
    SELECT m.mbn
    INTO random_officer_mbn
    FROM militaries m
             JOIN ranks r ON r.id = m.rank_id
             JOIN rank_categories rc ON rc.id = r.rank_category_id
    WHERE rc.name = 'Офицерский состав'
    ORDER BY RANDOM()
    LIMIT 1;

    RETURN random_officer_mbn;
END;
$$ LANGUAGE plpgsql;

WITH locations AS
         (SELECT *
          FROM (VALUES ((56.838011, 60.605729)::COORDINATE,
                        (620000, 'Россия', 'Свердловская область', 'Екатеринбург',
                         'пр. Ленина', '10')::ADDRESS),
                       ((55.160365, 61.402698)::COORDINATE,
                        (454510, 'Россия', 'Челябинская область', 'Магнитогорск',
                         'пр. Ленина', '5')::ADDRESS),
                       ((54.322658, 60.808403)::COORDINATE,
                        (454082, 'Россия', 'Челябинская область', 'Миасс',
                         'ул. Пушкина',
                         '25')::ADDRESS),
                       ((55.033333, 73.366667)::COORDINATE,
                        (644000, 'Россия', 'Омская область', 'Омск', 'пр. Ленина',
                         '20')::ADDRESS),
                       ((54.983333, 73.383333)::COORDINATE,
                        (644001, 'Россия', 'Омская область', 'Омск', 'ул. Мира',
                         '15')::ADDRESS),
                       ((56.852593, 53.204843)::COORDINATE,
                        (618400, 'Россия', 'Пермский край', 'Березники',
                         'пр. Ленина', '3')::ADDRESS),
                       ((52.608837, 39.588429)::COORDINATE,
                        (394026, 'Россия', 'Воронежская область', 'Воронеж',
                         'ул. Пушкина',
                         '14')::ADDRESS),
                       ((55.185135, 56.920101)::COORDINATE,
                        (453150, 'Россия', 'Челябинская область', 'Аша',
                         'ул. Ленина', '1')::ADDRESS),
                       ((52.036563, 47.378426)::COORDINATE,
                        (410009, 'Россия', 'Саратовская область', 'Саратов',
                         'пр. Мира',
                         '21')::ADDRESS),
                       ((55.162109, 61.418404)::COORDINATE,
                        (454021, 'Россия', 'Челябинская область', 'Магнитогорск',
                         'ул. Победы', '7')::ADDRESS),
                       ((54.993101, 73.377214)::COORDINATE,
                        (644112, 'Россия', 'Омская область', 'Омск', 'ул. Кирова',
                         '10')::ADDRESS),
                       ((52.963951, 36.062760)::COORDINATE,
                        (301167, 'Россия', 'Тульская область', 'Тула', 'пл. Ленина',
                         '5')::ADDRESS),
                       ((55.767548, 49.111737)::COORDINATE,
                        (420039, 'Россия', 'Татарстан', 'Казань', 'пр. Победы',
                         '12')::ADDRESS),
                       ((55.788774, 49.122051)::COORDINATE,
                        (420090, 'Россия', 'Татарстан', 'Казань', 'ул. Ленина', '7')::ADDRESS),
                       ((52.651315, 41.474940)::COORDINATE,
                        (394000, 'Россия', 'Воронежская область', 'Воронеж',
                         'ул. Кирова',
                         '3')::ADDRESS),
                       ((53.246488, 50.255732)::COORDINATE,
                        (442530, 'Россия', 'Самарская область', 'Самара',
                         'пл. Победы',
                         '8')::ADDRESS),
                       ((53.348202, 50.280191)::COORDINATE,
                        (443012, 'Россия', 'Самарская область', 'Самара',
                         'пр. Ленина',
                         '2')::ADDRESS),
                       ((55.578900, 39.529300)::COORDINATE,
                        (141400, 'Россия', 'Московская область', 'Химки',
                         'ул. Пушкина',
                         '13')::ADDRESS),
                       ((56.071343, 60.168455)::COORDINATE,
                        (624019, 'Россия', 'Свердловская область',
                         'Каменск-Уральский',
                         'ул. Советская', '6')::ADDRESS),
                       ((56.502876, 58.073083)::COORDINATE,
                        (623475, 'Россия', 'Свердловская область', 'Полевской',
                         'пр. Ленина', '4')::ADDRESS),
                       ((57.560566, 39.866733)::COORDINATE,
                        (157009, 'Россия', 'Ивановская область', 'Костерево',
                         'ул. Ленина',
                         '17')::ADDRESS),
                       ((54.735147, 56.002002)::COORDINATE,
                        (452470, 'Россия', 'Челябинская область', 'Пласт',
                         'пр. Победы',
                         '11')::ADDRESS),
                       ((55.236762, 84.374643)::COORDINATE,
                        (630080, 'Россия', 'Новосибирская область', 'Новосибирск',
                         'ул. Ленина', '26')::ADDRESS),
                       ((54.549286, 55.912288)::COORDINATE,
                        (453330, 'Россия', 'Челябинская область', 'Троицк',
                         'ул. Пушкина',
                         '9')::ADDRESS),
                       ((55.169892, 61.392220)::COORDINATE,
                        (454000, 'Россия', 'Челябинская область', 'Магнитогорск',
                         'пр. Победы', '10')::ADDRESS),
                       ((58.045634, 56.229343)::COORDINATE,
                        (427980, 'Россия', 'Пермский край', 'Соликамск',
                         'ул. Ленина', '5')::ADDRESS),
                       ((52.488735, 58.256424)::COORDINATE,
                        (461820, 'Россия', 'Оренбургская область', 'Орск',
                         'пр. Победы',
                         '22')::ADDRESS),
                       ((56.702384, 122.468647)::COORDINATE,
                        (658630, 'Россия', 'Забайкальский край', 'Горный',
                         'ул. Ленина',
                         '2')::ADDRESS),
                       ((46.679106, 38.278298)::COORDINATE,
                        (347900, 'Россия', 'Ростовская область', 'Батайск',
                         'пр. Мира',
                         '19')::ADDRESS),
                       ((56.900395, 65.845174)::COORDINATE,
                        (628012, 'Россия', 'Свердловская область', 'Нижний Тагил',
                         'ул. Кирова', '7')::ADDRESS),
                       ((43.318322, 45.629856)::COORDINATE,
                        (369000, 'Россия', 'Ростовская область', 'Шахты',
                         'пр. Победы',
                         '4')::ADDRESS),
                       ((58.464660, 38.598664)::COORDINATE,
                        (171678, 'Россия', 'Тверская область', 'Зубцов',
                         'ул. Ленина',
                         '11')::ADDRESS),
                       ((51.541799, 46.008597)::COORDINATE,
                        (404169, 'Россия', 'Волгоградская область', 'Волжский',
                         'ул. Пушкина', '6')::ADDRESS),
                       ((56.294206, 38.133812)::COORDINATE,
                        (141732, 'Россия', 'Московская область', 'Наро-Фоминск',
                         'пл. Ленина', '8')::ADDRESS),
                       ((56.103439, 47.268092)::COORDINATE,
                        (603000, 'Россия', 'Нижегородская область',
                         'Нижний Новгород',
                         'пр. Победы', '3')::ADDRESS),
                       ((55.862405, 37.624848)::COORDINATE,
                        (123308, 'Россия', 'Московская область', 'Москва',
                         'ул. Мира', '6')::ADDRESS),
                       ((45.035470, 38.974711)::COORDINATE,
                        (346880, 'Россия', 'Ростовская область', 'Таганрог',
                         'ул. Ленина',
                         '13')::ADDRESS),
                       ((54.318890, 36.550556)::COORDINATE,
                        (302029, 'Россия', 'Тульская область', 'Тула', 'ул. Пушкина',
                         '10')::ADDRESS),
                       ((60.078862, 30.398727)::COORDINATE,
                        (199034, 'Россия', 'Санкт-Петербург', 'Санкт-Петербург',
                         'пр. Ленина', '16')::ADDRESS),
                       ((51.530370, 46.020875)::COORDINATE,
                        (404106, 'Россия', 'Волгоградская область', 'Волжский',
                         'пр. Победы', '2')::ADDRESS),
                       ((59.379340, 56.517316)::COORDINATE,
                        (614433, 'Россия', 'Пермский край', 'Пермь', 'ул. Мира',
                         '9')::ADDRESS),
                       ((51.698656, 39.197930)::COORDINATE,
                        (394038, 'Россия', 'Воронежская область', 'Воронеж',
                         'пр. Ленина',
                         '4')::ADDRESS),
                       ((52.101288, 23.687294)::COORDINATE,
                        (243700, 'Россия', 'Гродненская область', 'Гродно',
                         'пл. Победы',
                         '7')::ADDRESS),
                       ((56.032199, 93.036513)::COORDINATE,
                        (655017, 'Россия', 'Красноярский край', 'Ачинск',
                         'ул. Ленина',
                         '19')::ADDRESS),
                       ((56.172600, 95.307800)::COORDINATE,
                        (662034, 'Россия', 'Красноярский край', 'Зеленогорск',
                         'пр. Мира',
                         '6')::ADDRESS),
                       ((53.222640, 50.199172)::COORDINATE,
                        (443057, 'Россия', 'Самарская область', 'Самара',
                         'ул. Ленина',
                         '1')::ADDRESS),
                       ((56.277417, 37.538393)::COORDINATE,
                        (141430, 'Россия', 'Московская область', 'Химки',
                         'пр. Победы',
                         '11')::ADDRESS),
                       ((55.862405, 37.624848)::COORDINATE,
                        (123308, 'Россия', 'Московская область', 'Москва',
                         'ул. Мира', '6')::ADDRESS),
                       ((52.287705, 104.282038)::COORDINATE,
                        (664011, 'Россия', 'Иркутская область', 'Иркутск',
                         'ул. Сухэ-Батора', '7')::ADDRESS),
                       ((52.262539, 104.261343)::COORDINATE,
                        (664074, 'Россия', 'Иркутская область', 'Иркутск',
                         'ул. Лермонтова', '83')::ADDRESS))
                   AS locations(coordinate, address))
INSERT
INTO units (name, coordinate, address, commander_mbn)
SELECT ROW_NUMBER() OVER () || '-я воинская часть' AS name,
       l.coordinate                                AS coordinate,
       l.address                                   AS address,
       get_random_officer_mbn()                    AS commander_mbn
FROM locations l
ON CONFLICT
    DO NOTHING;
DROP FUNCTION get_random_officer_mbn;
